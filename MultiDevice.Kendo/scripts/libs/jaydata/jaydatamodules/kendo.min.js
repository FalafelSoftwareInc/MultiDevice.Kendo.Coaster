(function(n){var i=n.Entity.inheritedTypeProcessor,t,r;n.kendo={};n.kendo.BaseModelType=kendo.data.Model.define({init:function(n){kendo.data.Model.fn.init.call(this,n)}});t={"$data.Blob":"string","$data.String":"string","$data.Boolean":"boolean","$data.Integer":"number","$data.Number":"number","$data.Date":"date","$data.DateTimeOffset":"date","$data.Time":"string","$data.Byte":"number","$data.SByte":"number","$data.Int16":"number","$data.Int32":"number","$data.Int64":"number","$data.Decimal":"string","$data.Float":"number"};n.Entity.inheritedTypeProcessor=function(r){function f(n){return t[n]||"object"}function e(t){function s(n,t){return n==="$data.Boolean"?!0:t.required!==!0}function h(n,t){return"$data.Boolean"===n?!1:t.required||"nullable"in t?!t.nullable:!1}function c(){return}var e=r.memberDefinitions,o={},i,u;e.getPublicMappedProperties().forEach(function(t){var i=n.Container.resolveName(t.type);o[t.name]={type:f(i,t),nullable:s(i,t),defaultValue:t.defaultValue,editable:!t.computed,validation:{required:h(i,t)}}});i={fields:o,init:function(i){var g=t&&t.owningContextType||undefined,w=[],o,l,k,a,y,d,p,f,s,v;t&&t.owningContextType&&(w=t.owningContextType.memberDefinitions.getPublicMappedProperties().filter(function(t){return n.Container.resolveType(t.type)===n.EntitySet}).map(function(t){return n.Container.resolveType(t.elementType)}));var b={entityBuilder:function(t,r){r.forEach(function(r){var u,f;r.key===!0||r.required!==!0&&r.nullable!==!1||(u=n.Container.resolveType(r.type),u.isAssignableTo&&u.isAssignableTo(n.Entity)&&w.indexOf(u)===-1?(i&&(f=i[r.name]),t[r.name]=new u(f,b)):c(t,r))})}},u=i instanceof r?i:new r(i,b),h=u.initData,e={};for(f in h)o=r.getMemberDefinition(f),l=h[f],l instanceof n.Entity?(k=l.asKendoObservable(),e[f]=k):o&&n.Container.resolveType(o.type)===Array?(a=n.Container.resolveType(o.elementType),y=a,a.asKendoModel&&(y=a.asKendoModel()),d=new kendo.data.ObservableArray(h[f],y),e[f]=d,e[f].bind("change",function(){u.changeFromKendo=!0;this.parent().dirty=!0;u[o.name]=this.toJSON();delete u.changeFromKendo})):e[f]=o&&n.Container.resolveType(o.type)===n.Blob?n.Blob.toBase64(l):l;for(p=r.memberDefinitions.getPublicMappedProperties().filter(function(t){return n.Container.resolveType(t.dataType)===Array&&!n.Container.resolveType(t.elementType).asKendoModel}),f=0;f<p.length;f++)s=p[f],(h[s.name]===null||h[s.name]===undefined)&&(e[s.name]=new kendo.data.ObservableArray([],n.Container.resolveType(s.elementType)),e[s.name].bind("change",function(){u.changeFromKendo=!0;this.parent().dirty=!0;u[s.name]=this.toJSON();delete u.changeFromKendo}));v=this;this.innerInstance=function(){return u};n.kendo.BaseModelType.fn.init.call(this,e);u.propertyChanged.attach(function(t,i){var o=this,r=i.newValue,f=u.getType().getMemberDefinition(i.propertyName),e;o.changeFromKendo?n.Container.resolveType(f.type)===n.Blob&&(e=n.Blob.toString(r),r=n.Container.convertTo(atob(e),n.Blob),u.changeFromJay=!0,u.initData[f.name]=r,delete u.changeFromJay):(r=r?r.asKendoObservable?r.asKendoObservable():r:r,u.changeFromJay=!0,n.Container.resolveType(f.type)===n.Blob&&r&&(r=n.Blob.toBase64(r)),v.set(i.propertyName,r),f.computed&&v[i.propertyName]!==r&&(v[i.propertyName]=r),delete u.changeFromJay)});this.bind("set",function(i){var o=i.field,f=o.split("."),r,e;u.changeFromKendo=!0;f.length==1?(r=i.value,u.changeFromJay||(r=r.innerInstance?r.innerInstance():r,u[o]=r,t&&t.autoSave&&u.save())):(e=u[f[0]],e instanceof n.Entity&&(u[f[0]]=e));delete u.changeFromKendo});t&&t.newInstanceCallback&&t.newInstanceCallback(u)},save:function(){return this.innerInstance().save()},remove:function(){return this.innerInstance().remove()}};u=e.getKeyProperties();switch(u.length){case 0:break;case 1:i.id=u[0].name;break;default:console.warn("entity with multiple keys not supported")}return n.Trace.log("md",i),kendo.data.Model.define(n.kendo.BaseModelType,i)}function o(n){var t=n||r;return t.kendoModelType||(t.kendoModelType=e(n))}function s(n,t){var i=r.asKendoModel(t);return new i(n)}function u(n){return n||""}function h(n,t){if(t.provider){var i=u(t.databaseName)+u(t.tableName)+u(t.url)+u(t.apiUrl)+u(t.oDataServiceHost),r={provider:t.provider,databaseName:t.databaseName,tableName:t.tableName,dataSource:t.url,apiUrl:t.apiUrl,oDataServiceHost:t.oDataServiceHost};return Object.keys(r).forEach(function(n){delete t[n]}),n.setStore(i,r),i}}var c=r.memberDefinitions;r.asKendoModel=o;r.prototype.asKendoObservable=function(n){var t=this;return s(this,n)};r.asKendoDataSource=function(t,i,u){t=t||{};var f=i||{},e=h(r,t)||u,o=n.ItemStore._getStoreAlias(r,e),s=n.ItemStore._getContextPromise(o,r),c=s.getEntitySetFromElementType(r);return c.asKendoDataSource(t,f)};i&&i(r)};n.Queryable.addMember("asKendoColumns",function(i){function e(n){n=Array.isArray(n)?n:[n];var t=this.concat(n);return r(t)}function o(n){n=Array.isArray(n)?n:[n];var t=n.concat(this);return r(t)}function s(n,t){var i=this.filter(function(t){return t.field==n})[0];return $.extend(i,t),this}function r(n){return n.prepend=o,n.append=e,n.setColumn=s,n}var u=[],f;return i=i||{},f=i.$showComplexFields===!0,delete i.$showComplexFields,this.defaultType.memberDefinitions.getPublicMappedProperties().forEach(function(r){if(f||t[n.Container.resolveName(r.type)]){var o=i[r.name]||{},e={field:r.name};$.extend(e,o);u.push(e)}}),r(u)});n.EntityContext.addProperty("EntitySetNames",function(){var n=this;return Object.keys(n._entitySetReferences).map(function(t){return n._entitySetReferences[t].tableName})});n.Queryable.addMember("asKendoModel",function(n){return n.owningContextType=n.owningContextType||this.entityContext.getType(),this.defaultType.asKendoModel(n)});n.Queryable.addMember("asKendoRemoteTransportClass",function(){var i=this,t=i.entityContext;return kendo.data.RemoteTransport.extend({init:function(){this.items=[]},read:function(t){var r=i;r.entityContext.onReady().then(function(){var c=this,u=r,l=r.entityContext.storageProvider,e=r.entityContext.storageProvider.supportedSetOperations.withInlineCount,h=!e&&r.entityContext.storageProvider.supportedSetOperations.length,i,o,s,f;e&&(u=u.withInlineCount());t.data.filter&&(i="",o={},t.data.filter.filters.forEach(function(r,u){u>0&&(i+=t.data.filter.logic=="or"?" || ":" && ");switch(r.operator){case"eq":i+="it."+r.field;i+=" == this."+r.field;break;case"neq":i+="it."+r.field;i+=" != this."+r.field;break;case"startswith":i+="it."+r.field;i+=".startsWith(this."+r.field+")";break;case"contains":i+="it."+r.field;i+=".contains(this."+r.field+")";break;case"doesnotcontain":i+="!";i+="it."+r.field;i+=".contains(this."+r.field+")";break;case"endswith":i+="it."+r.field;i+=".endsWith(this."+r.field+")";break;case"gte":i+="it."+r.field;i+=" >= this."+r.field;break;case"gt":i+="it."+r.field;i+=" > this."+r.field;break;case"lte":i+="it."+r.field;i+=" <= this."+r.field;break;case"lt":i+="it."+r.field;i+=" < this."+r.field;break;default:n.Trace.log("unknown operator",r.operator)}o[r.field]=r.value}),u=u.filter(i,o));s=u;t.data.sort&&t.data.sort.forEach(function(n){u=u.order((n.dir=="desc"?"-":"")+n.field)});t.data.skip&&(u=u.skip(t.data.skip));t.data.take&&(u=u.take(t.data.take));f=[];f.push(u.toArray());h?f.push(s.length()):e||f.push(s.toArray());n.Trace.log(f);jQuery.when.apply(this,f).then(function(i,r){var f=i.map(function(t){var i=t instanceof n.Entity?t.initData:t;return t.asKendoObservable()}),u={data:f,total:e?i.totalCount:h?r:r.length};n.Trace.log(u);t.success(u)}).fail(function(){console.log("error in create");t.error({},arguments)})})},create:function(n,r){var u=i;u.entityContext.onReady().then(function(){if(r.length>1){var i=[];r.forEach(function(n){i.push(n.innerInstance())});t.addMany(i);t.saveChanges().then(function(){var t=[];i.forEach(function(n){t.push(n.initData)});n.success()}).fail(function(){console.log("error in create");n.error({},arguments);t.stateManager.reset()})}else r[0].innerInstance().save(t.storeToken).then(function(){n.success()}).fail(function(){console.log("error in create");n.error({},arguments)})})},update:function(n,r){var u=i;u.entityContext.onReady().then(function(){if(r.length>1){var i=r.map(function(n){return n.innerInstance()});i.forEach(function(n){t.attach(n,!0)});t.saveChanges().then(function(){n.success()}).fail(function(){t.stateManager.reset();n.error({},arguments)})}else r[0].innerInstance().save().then(function(){n.success()}).fail(function(){n.error({},arguments)})})},destroy:function(n,r){var u=i;u.entityContext.onReady().then(function(){r.length>1?(r.forEach(function(n){t.remove(n.innerInstance())}),t.saveChanges().then(function(){n.success({data:n.data})}).fail(function(){t.stateManager.reset();n.error({},"error",n.data)})):r[0].innerInstance().remove().then(function(){n.success({data:n.data})}).fail(function(){t.stateManager.reset();n.error({},"error",n.data)})})},setup:function(){n.Trace.log("setup");n.Trace.log(arguments)}})});r=kendo.data.DataSource.extend({init:function(){kendo.data.DataSource.fn.init.apply(this,arguments)},createItem:function(n){var t=this.options.schema.model;return new t(n)},_promise:function(n,t,i){var r=this,f=$.extend,u=r.transport;return $.Deferred(function(e){u[i].call(u,f({success:function(n){e.resolve({response:n,models:t,type:i})},error:function(n,t,i){e.reject(n);r.error(n,t,i)}},n),t)}).promise()}});n.kendo=n.kendo||{};n.kendo.defaultPageSize=25;n.Queryable.addMember("asKendoDataSource",function(t,i){var f=this,u,e;return i=i||{},u=f.asKendoModel(i),t=t||{},t.serverPaging=t.serverPaging||!0,t.serverFiltering=t.serverFiltering||!0,t.serverSorting=t.serverSorting||!0,t.pageSize=t.pageSize===undefined?n.kendo.defaultPageSize:t.pageSize,e=f.asKendoRemoteTransportClass(u),t.transport=new e,t.schema={model:u,data:"data",total:"total"},new r(t)});kendo.data.binders.submit=kendo.data.Binder.extend({init:function(n,t,i){kendo.data.Binder.fn.init.call(this,n,t,i);$(n).bind("submit",function(){var n=t.submit.source,i=n[t.submit.path];if(typeof i=="function")return i.apply(n,arguments),!1})},refresh:function(){}})})($data);
/*
//# sourceMappingURL=kendo.min.js.map
*/